# 对话调试工具 - 快速开始

## 🎯 一分钟上手

### 1️⃣ 打开调试工具

```
文档助手面板（右侧） → 点击"调试"按钮（紫色，Bug图标）
```

### 2️⃣ 查看对话列表

左侧显示所有对话消息：
- 🟢 用户消息
- 🟣 AI回复

### 3️⃣ 查看详细信息

点击任意消息，右侧显示：
- ✅ 消息内容
- 🟩 系统提示词（完整）
- 🟪 模型输出（500字符）
- 📊 来源信息
- 🔍 调试路径

## 🔍 主要用途

### 调试提示词
查看实际发送给大模型的完整提示词，包括：
- 系统角色定义
- 历史对话上下文
- 当前问题
- 文档内容
- 回答指令

**使用场景**：
- 检查为什么AI回答不理想
- 验证历史对话是否正确传递
- 优化提示词设计

### 分析模型输出
对比原始输出和最终显示内容：
- 检查输出质量
- 发现异常内容
- 验证后处理逻辑

**使用场景**：
- AI回答有误时排查原因
- 评估模型表现
- 测试不同问法的效果

## 📋 界面功能

### 左侧面板
| 元素 | 说明 |
|------|------|
| 刷新按钮 | 重新加载对话列表 |
| 对话计数 | 显示总对话数 |
| 消息卡片 | 点击查看详情，已选中会变蓝 |

### 右侧面板
| 区块 | 内容 | 颜色 |
|------|------|------|
| 消息内容 | 用户问题或AI回答 | 灰色 |
| 系统提示词 | 完整提示词 | 绿色 |
| 原始输出 | 前500字符 | 紫色 |
| 来源信息 | JSON格式 | 蓝色 |
| 调试路径 | JSON格式 | 黄色 |
| 元数据 | ID和时间戳 | 灰色 |

## ⚡ 快捷操作

- **关闭**: 点击右上角 × 
- **刷新**: 左侧"刷新"按钮
- **切换消息**: 左侧点击不同消息
- **滚动查看**: 右侧支持独立滚动

## 💡 使用技巧

### 1. 对比不同回答
选择多个AI回复消息，对比它们的：
- 系统提示词差异
- 原始输出质量
- 来源信息准确性

### 2. 追踪多轮对话
按时间顺序查看消息，验证：
- 上下文是否正确累积
- 历史信息是否准确
- 对话是否连贯

### 3. 优化提示词
根据实际使用的提示词：
- 调整API配置
- 改进系统提示
- 优化文档组织

## 🚨 注意事项

1. **性能**：加载100条消息需要几秒钟
2. **隐私**：提示词可能包含文档内容，注意保密
3. **兼容性**：旧对话可能缺少部分字段
4. **限制**：原始输出只保存前500字符

## 🛠️ 故障排除

### 调试按钮灰色
**原因**：AI正在思考中  
**解决**：等待回答完成

### 看不到提示词/输出
**原因**：旧版本对话记录  
**解决**：发起新对话，新记录会包含这些信息

### 列表为空
**原因**：当前文档还没有对话  
**解决**：先向AI提问，产生对话记录

### 加载失败
**原因**：网络或服务器问题  
**解决**：检查API连接，点击刷新重试

## 🎨 界面预览

```
┌──────────────────────────────────────────────────────────┐
│  对话调试工具                                     [×]     │
├──────────────┬───────────────────────────────────────────┤
│ 对话列表 (5) │                                           │
│  [刷新]      │  选择一条消息查看详情                     │
│              │                                           │
│ 🟢 用户 #1   │                                           │
│ 质保期多久？ │                                           │
│              │                                           │
│ 🟣 AI #2  ✓  │                                           │
│ 根据文档... │                                           │
│              │                                           │
│ 🟢 用户 #3   │                                           │
│ 从何时算起？ │                                           │
└──────────────┴───────────────────────────────────────────┘
```

## 📚 相关文档

- [对话信息增强功能](lib/docmind-ai/CONVERSATION_FIELDS_ENHANCEMENT.md)
- [完整使用指南](CONVERSATION_DEBUG_GUIDE.md)
- [API文档](lib/docmind-ai/api/document_routes.py)

## 🔗 技术参考

- **组件**: `components/ConversationDebugModal.tsx`
- **API**: `GET /api/documents/{document_id}/conversations`
- **数据表**: `conversations` (lib/docmind-ai/api/database.py:146)
